<script setup>
import {ref} from "vue";
import {toastViewerInstance} from "~/useToastViewer";
import {VTreeview} from 'vuetify/labs/VTreeview'


// ÌîºÎãàÏïÑ.
const documentList = useDocumentList();
const createDocument = useCreateDocument();
const bookmarks = useBookMarks();
const attachedFile = useAttachedFile();
const color = useColor();
const group = useGroup();

// ÏÉÅÎã® ÎÑ§ÎπÑ Ï†úÎ™© ÏÑ§Ï†ï
group.TopNaviGroupList = ["Knowledge is Power", "Ï†ÑÏ≤¥Í≥µÍ∞úÎ¨∏ÏÑú", "ÌÉúÍ∑∏ Í≤ÄÏÉâ  (ALT + H) üè∑Ô∏è"];

// Í∏∞Î≥∏ Î≥ÄÏàòÎì§
const loading = ref(false);
const titleLoding = ref(false)
const snackbar = ref(false);
const dialog = ref(false);
const viewer = ref();
const upLinkId = ref();

// Ï≤®Î∂ÄÌååÏùº Í¥ÄÎ†®
const files = ref([]);
const fileDialog = ref(false);
const fileLoading = ref(false);
const attachedFileModal = ref(false);


// Ï¥àÍ∏∞ Î¨∏ÏÑú ÏÑ∏ÌåÖ
await bookmarks.setMyBookMarks();
await documentList.setPublicDocumentList();          // Î¨∏ÏÑúÎ¶¨Ïä§Ìä∏ ÏÑ∏ÌåÖ
await documentList.setFirstPublicDocumentDetails();  // ÏµúÏÉÅÎã® Î¨∏ÏÑú Ï†ïÎ≥¥ ÏÑ∏ÌåÖ
await attachedFile.setAttachedFileList(documentList.getFirstPublicDocId);
const UpdateToastViewer = async () => {
  viewer.value = await toastViewerInstance(
      viewer.value,
      documentList.getSelectedDocContent
  );
}
onMounted(async () => {
  await UpdateToastViewer()
})

// Ìï¥ÏãúÌÉúÍ∑∏ ÏóÖÎç∞Ïù¥Ìä∏ Í¥ÄÎ†®
const hashTagUpdateModal = ref(false);
const hashTagsUpdateReqDto = ref({
  documentId: "",
  hashTags: []
});
const hashTagUpdateModalOpen = async () => {
  await documentList.setHashTagsForTop100List();
  hashTagsUpdateReqDto.value.documentId = documentList.getSelectedDocId
  hashTagsUpdateReqDto.value.hashTags = documentList.returnHashTagsForTop100List()
  hashTagUpdateModal.value = !hashTagUpdateModal.value
}
const hashTagUpdateReq = () => {
  documentList.updateHashTags(hashTagsUpdateReqDto.value)
  hashTagUpdateModal.value = false;
}
const Top100HashTagAddAndFiltering = (hashTagId, hashTageName) => {
  documentList.filterPublicDocByHashTag(hashTagId)
  if (!hashTagsUpdateReqDto.value.hashTags.includes(hashTageName))
    hashTagsUpdateReqDto.value.hashTags.push(hashTageName)
  else alert(`${hashTageName}ÏùÄ Ïù¥ÎØ∏ Ï∂îÍ∞ÄÎêú Ìï¥ÏÉàÌÉúÍ∑∏ ÏûÖÎãàÎã§.`)
}
const ResetHasTagAddAndFiltering = async () => {
  await documentList.setHashTagsForTop100List()
  await documentList.setPublicDocumentList()
}

// Î¨∏ÏÑú ÏÇ≠Ï†ú Í¥ÄÎ†® ÏΩîÎìú.
const deleteDocModalOpen = ref();
const selectedDeleteDocTitle = ref();
const selectedDeleteDocId = ref();
const OpenDeleteDocumentModal = async (documenetTitle, documentId) => {
  loading.value = false;
  if (documentList.getPublicDocumentList.length > 1 && documentId !== 2) {
    deleteDocModalOpen.value = true;
    selectedDeleteDocTitle.value = documenetTitle;
    selectedDeleteDocId.value = documentId;
  } else if (documentId === 2) alert("Í≥µÏßÄÏÇ¨Ìï≠ Î¨∏ÏÑúÎäî ÏÇ≠Ï†úÌï† Ïàò ÏóÜÏäµÎãàÎã§.")
  else alert("Ï†ÑÏ≤¥Í≥µÍ∞úÎ¨∏ÏÑúÎäî 1Í∞úÏù¥ÏÉÅ ÏûàÏñ¥Ïïº Ìï©ÎãàÎã§.");
}
const realDeleteSelectedDoc = async () => {
  loading.value = true;
  await documentList.deleteDocument(selectedDeleteDocId.value)
  await documentList.setPublicDocumentList();
  await wait(800);
  deleteDocModalOpen.value = false;
  snackbar.value = true;
}

// Î¨∏ÏÑú Ï†úÎ™© ÏóÖÎç∞Ïù¥Ìä∏ Í¥ÄÎ†®
const titleEditing = ref(false);
const newTitle = ref();
const showTitleEditor = () => {
  titleEditing.value = !titleEditing.value
  newTitle.value = documentList.getSelectedDocTitle;

}
const updateDocumentTitle = async () => {
  titleEditing.value = false
  await documentList.updateDocumentTitle(
      documentList.getSelectedDocId,
      newTitle.value)
  await documentList.setPublicDocumentList()
  newTitle.value = ""
}

// Î¨∏ÏÑú ÏÑ†ÌÉù Ïãú ÏÉÅÏÑ∏ Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò§Îäî Ìï®Ïàò
const selectDocument = async (documentId) => {
  // Î¨∏ÏÑúÏùò ÏÉÅÏÑ∏ Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò¥
  await documentList.setDocumentDetails(documentId);
  await attachedFile.setAttachedFileList(documentId);
  await UpdateToastViewer();
};

// Î¨∏ÏÑúÏûëÏÑ± Í¥ÄÎ†®ÏΩîÎìú
const postForm = ref();
const openCreateNewDocument = () => {
  upLinkId.value = null;
  dialog.value = !dialog.value;
}
const handleData = async (form) => {
  form.groupId = null;
  form.upLinkId = null;
  const temp = await createDocument.createNewDocument(form)
  await documentList.setPublicDocumentList();
  await selectDocument(temp.documentId);
  dialog.value = false;
}

//  Î¨∏ÏÑú ÏàòÏ†ï
const createNewVersionModal = ref(false);
const versionHistoryModal = ref(false);
const updateContent = ref();
const createNewVersion = async (form) => {
  await documentList.updateVersion(documentList.getSelectedDocId, form.value.content, form.value.message);
  await UpdateToastViewer()
  createNewVersionModal.value = false;
}


// Ï†ÑÏ≤¥Í≥µÍ∞úÎ¨∏ÏÑú Í∏∞Ï°¥Í∑∏Î£πÏúºÎ°ú Ïù¥Îèô
const handlerMoveDocToGroup = ref(false)
const selectedTargetGroupName = ref("ÌïúÌôîÏãúÏä§ÌÖú")
const selectedTargetDocumentTitle = ref("")
const moveDocToGroupReq = ref({
  targetDocumentId: "",
  targetGroupId: "1"
})
const realShowGroupModalForSelect = async (documenetTitle, documentId) => {
  if (documentList.getPublicDocumentList.length > 1 && documentId !== 2) {
    await group.setHierarchyInfo();
    selectedTargetGroupName.value = "ÌïúÌôîÏãúÏä§ÌÖú"
    handlerMoveDocToGroup.value = true
    moveDocToGroupReq.value.targetDocumentId = documentId
    selectedTargetDocumentTitle.value = documenetTitle
  } else if (documentId === 2) alert("Í≥µÏßÄÏÇ¨Ìï≠ Î¨∏ÏÑúÎäî Ïù¥ÎèôÌï† Ïàò ÏóÜÏäµÎãàÎã§.")
  else alert("Ï†ÑÏ≤¥Í≥µÍ∞úÎ¨∏ÏÑúÎäî 1Í∞úÏù¥ÏÉÅ ÏûàÏñ¥Ïïº Ìï©ÎãàÎã§.");
}
const SetTargetGroupIdAndName = (selectedGroupInfo) => {
  moveDocToGroupReq.value.targetGroupId = selectedGroupInfo.id
  selectedTargetGroupName.value = selectedGroupInfo.title
}
const RealMoveDocToTargetGroup = async () => {
  if (confirm(`${selectedTargetDocumentTitle.value} Î¨∏ÏÑúÎ•º Ïù¥ÎèôÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
    handlerMoveDocToGroup.value = false
    await documentList.moveDocumentToTargetGroup(moveDocToGroupReq.value)
    await documentList.setPublicDocumentList();
    alert("Î¨∏ÏÑúÍ∞Ä Ï†ïÏÉÅÏ†ÅÏúºÎ°ú Ïù¥ÎèôÌïòÏòÄÏäµÎãàÎã§.")
  }
}

// Ï≤®Î∂ÄÌååÏùº
const fileDialogOpen = () => {
  files.value = []; // ÌååÏùº Î™©Î°ù Ï¥àÍ∏∞Ìôî
  fileLoading.value = false;
  fileDialog.value = !fileDialog.value;
}
const handleFileUpload = async () => {
  fileLoading.value = true; // ÎπôÍ∏ÄÏù¥ ÏãúÏûë
  await wait(1200); // 1.2Ï¥à ÎåÄÍ∏∞
  // Í∞Å ÌååÏùºÏóê ÎåÄÌï¥ ÏóÖÎ°úÎìú Î°úÏßÅ Ïã§Ìñâ
  for (let file of files.value) {
    await attachedFile.setAttachedFileUpload(documentList.selectedDocumentDetails.documentId, file);
  }
  // ÌååÏùº ÏóÖÎ°úÎìú ÌõÑ Ï≤®Î∂ÄÌååÏùº Î™©Î°ù Îã§Ïãú Î∂àÎü¨Ïò§Í∏∞
  await attachedFile.setAttachedFileList(documentList.selectedDocumentDetails.documentId);
  fileLoading.value = false; // ÎπôÍ∏ÄÏù¥ ÎÅùÎÇ¥Í∏∞
  fileDialog.value = false; // Îã§Ïù¥ÏñºÎ°úÍ∑∏ Îã´Í∏∞
};
const handleFileClick = (url) => {
  window.open(url, '_blank');
};
const AttachedFileDelete = async (fileId) => {
  await attachedFile.setAttachedFileDelete(fileId);
  await wait(2000); // 1.2Ï¥à ÎåÄÍ∏∞
  // Ï≤®Î∂ÄÌååÏùº ÏÇ≠Ï†ú ÌõÑ Ï≤®Î∂ÄÌååÏùº Î™©Î°ù Îã§Ïãú Î∂àÎü¨Ïò§Í∏∞
  await attachedFile.setAttachedFileList(documentList.selectedDocumentDetails.documentId);
  attachedFileModal.value = false
};

// ÏÑ†ÌÉùÌïú Î¨∏ÏÑú IDÍ∞Ä Î∂ÅÎßàÌÅ¨ Î™©Î°ùÏóê ÏûàÎäîÏßÄ ÌôïÏù∏
const isBookmarked = computed(() =>
    bookmarks.myBookMarks.some(book => book.documentId === documentList.getSelectedDocId)
);

// Î∂ÅÎßàÌÅ¨ Î≤ÑÌäº ÌÅ¥Î¶≠ Ìï∏Îì§Îü¨
const handleBookmarkClick = async () => {
  // ÎßåÏïΩ ÌòÑÏû¨ Î¨∏ÏÑúÍ∞Ä Î∂ÅÎßàÌÅ¨ÎêòÏñ¥ ÏûàÎã§Î©¥, Î∂ÅÎßàÌÅ¨Î•º Ï†úÍ±∞ÌïòÎäî Ïï°ÏÖòÏùÑ Ïã§ÌñâÌï©ÎãàÎã§.
  if (isBookmarked.value) {
    await bookmarks.removeMyBookmark(documentList.getSelectedDocId);
  } else {
    await bookmarks.removeMyBookmark(documentList.getSelectedDocId);
  }

  // Î∂ÅÎßàÌÅ¨ ÏÉÅÌÉúÎ•º Í∞±Ïã†Ìï©ÎãàÎã§.
  await bookmarks.setMyBookMarks();
};

// Îã®Ï∂ïÌÇ§
import {onKeyStroke} from '@vueuse/core'
import {useKeyModifier} from '@vueuse/core'

const KipButton = ref(false)
const alt = useKeyModifier('Alt')
onKeyStroke(['Q', 'q'], () => {
  if (alt.value) KipButton.value = !KipButton.value;
})
onKeyStroke(['M', 'm'], () => {
  if (alt.value) handleBookmarkClick()
})
onKeyStroke(['N', 'n'], () => {
  if (alt.value) openCreateNewDocument()
})
onKeyStroke(['T', 't'], () => {
  if (alt.value) showTitleEditor()
})
onKeyStroke(['H', 'h'], () => {
  if (alt.value) hashTagUpdateModalOpen()
})
onKeyStroke(['A', 'a'], () => {
  if (alt.value) fileDialogOpen()
})
onKeyStroke(['R', 'r'], () => {
  if (alt.value) ResetHasTagAddAndFiltering();
})
onKeyStroke(['U', 'u'], () => {
  if (alt.value) createNewVersionModal.value = !createNewVersionModal.value;
})
onKeyStroke(['Y', 'y'], () => {
  if (alt.value) versionHistoryModal.value = !versionHistoryModal.value
})
onKeyStroke(['Enter'], () => {
  if (alt.value)
    if (dialog.value) postForm.value.submit();
    else if (createNewVersionModal.value) updateContent.value.submit();
})

</script>
<template>
  <v-container fluid>
    <v-row no-gutters>
      <!-- üëàüëàüëàüëàüëàüëàüëàüëà ÏôºÏ™Ω ÏÇ¨Ïù¥ÎìúÎ∞î -->
      <v-col cols="3">
        <v-list class="pa-4">
          <v-list-item>
            <v-list-item-title class="font-weight-bold headline text-center mb-4 pa-2">
              Ï†ÑÏ≤¥Í≥µÍ∞úÎ¨∏ÏÑú üåê
            </v-list-item-title>
          </v-list-item>
          <v-divider></v-divider>

          <!-- Ï†ÑÏ≤¥Í≥µÍ∞ú Î¨∏ÏÑú title Ï∂úÎ†• -->
          <v-tabs color="primary" direction="vertical" class="mt-4">
            <v-tab
                v-for="doc in documentList.getPublicDocumentList"
                :key="doc.documentId"
                @click="selectDocument(doc.documentId)">

              <div class="ellipsis" style="width:11vw; text-align: start">{{ doc.title }}</div>
              <v-spacer></v-spacer>
              <v-hover v-slot="{ isHovering, props }">

                <!--                  ‚ùåÔ∏è ÏÇ≠Ï†úÎ≤ÑÌäº -->
                <v-btn
                    icon="mdi-trash-can"
                    v-bind="props"
                    class="ml-5"
                    :class="{
                            'on-hover': isHovering,
                            'show-btns': isHovering
                          }"
                    color="rgba(255, 255, 255, 0)"
                    variant="plain"
                    @click="OpenDeleteDocumentModal(doc.title, doc.documentId)"
                />


                <!--                 ‚è©‚è© Í∑∏Î£πÏúºÎ°ú Ïù¥Îèô Î≤ÑÌäº  -->
                <v-btn
                    icon="mdi-location-exit"
                    v-bind="props"
                    :class="{
                            'on-hover': isHovering,
                            'show-btns': isHovering
                          }"
                    color="rgba(255, 255, 255, 0)"
                    variant="plain"
                    @click="realShowGroupModalForSelect(doc.title, doc.documentId)"
                />
              </v-hover>
            </v-tab>
          </v-tabs>
        </v-list>
        <!--            ‚è©‚è©  Í∑∏Î£π Ïù¥ÎèôÏùÑ ÏúÑÌïú Î™®Îã¨ -->
        <v-dialog
            class="d-flex"
            width="45vw"
            opacity="10%"
            v-model="handlerMoveDocToGroup">
          <v-sheet
              rounded="xl"
              class="pa-10">
            <div class="d-flex justify-space-between">
              <h2 class="mb-4 text-center">
                {{ `${selectedTargetDocumentTitle} Î¨∏ÏÑú üëâ ${selectedTargetGroupName} Í∑∏Î£πÏúºÎ°ú` }}</h2>
              <v-btn
                  color="info"
                  :loading="titleLoding"
                  text="Ïù¥ÎèôÌïòÍ∏∞ üöÄ"
                  type="submit"
                  @click="RealMoveDocToTargetGroup"
              />
            </div>
            <v-treeview
                :items="group.getHierarchyInfo"
                color="blue">
              <template v-slot:prepend="{ item }">
                <v-icon
                    v-if="item.children"
                    :icon="`mdi-${item.children.length === 0
                                ? 'account-group-outline' : 'folder-network'}`"
                    @click="SetTargetGroupIdAndName(item)"
                />
              </template>
              <template v-slot:title="{ item }">
                <div @click="SetTargetGroupIdAndName(item)">
                  {{ item.title }} {{ item.groupType === "DEPARTMENT" ? '&nbsp üè¢' : '&nbsp üöÄ' }}
                </div>
              </template>
            </v-treeview>
          </v-sheet>
        </v-dialog>

        <!--        ‚ùåÏÇ≠Ï†ú ÌôïÏù∏ Î™®Îã¨ --->
        <v-dialog
            v-model="deleteDocModalOpen"
            max-width="500">
          <v-card title="Î¨∏ÏÑú ÏÇ≠Ï†ú">
            <v-card-text>
              {{ selectedDeleteDocTitle }} Î¨∏ÏÑúÎ•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?
            </v-card-text>
            <v-card-actions>
              <v-spacer/>
              <v-btn
                  v-if="!loading"
                  text="Yes"
                  @click="realDeleteSelectedDoc"
              />
              <v-progress-circular
                  class="mr-5"
                  v-if="loading"
                  color="primary"
                  indeterminate
              />
              <v-btn
                  text="No"
                  @click="deleteDocModalOpen = false"/>
            </v-card-actions>
          </v-card>
        </v-dialog>
        <v-snackbar
            :color="color.kipMainColor"
            rounded="pill"
            elevation="24"
            v-model="snackbar"
            :timeout="3000">
          <div class="text-center">{{ selectedDeleteDocTitle }} Î¨∏ÏÑúÍ∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.</div>
        </v-snackbar>

        <!--        Î¨∏ÏÑú ÏûëÏÑ±ÏùÑ ÏúÑÌïú Î™®Îã¨ -->
        <v-dialog v-model="dialog"
                  width="95vw"
                  opacity="90%"
        >
          <v-card  rounded="xl"
                   class="pa-8">
            <v-card-actions
                style="
                display: flex;
                justify-content: end;
                position: fixed;
                top: 60px; right: 30px;
                width: 12vw;
                z-index: 9999;">
              <v-btn
                  style="background-color: darkred; color: white"
                  @click=postForm.submit()>Ï†ÄÏû•
                <v-tooltip
                    activator="parent"
                    location="start">ALT + Enter
                </v-tooltip>
              </v-btn>
              <v-btn
                  style="background-color: var(--secondary-color); color: white"
                  @click="dialog = false">Îã´Í∏∞
                <v-tooltip
                    activator="parent"
                    location="bottom">ALT + N
                </v-tooltip>
              </v-btn>
            </v-card-actions>
            <PostForm ref="postForm" @submit="handleData"></PostForm>
          </v-card>
        </v-dialog>


        <!--      Î¨∏ÏÑú ÏàòÏ†ïÏùÑ ÏúÑÌïú Î™®Îã¨ -->
        <v-dialog v-model="createNewVersionModal"
                  width="95vw"
                  opacity="90%"
        >
          <v-card  rounded="xl"
                   class="pa-8">
            <v-card-actions
                style="
                display: flex;
                justify-content: end;
                position: fixed;
                top: 50px; right: 35px;
                width: 12vw;
                z-index: 9999;">
              <v-btn
                  style="background-color: darkred; color: white"
                  @click=updateContent.submit()>Ï†ÄÏû•
                <v-tooltip
                    activator="parent"
                    location="start">ALT + Enter
                </v-tooltip>
              </v-btn>
              <v-btn
                  style="background-color: var(--secondary-color); color: white"
                  @click="createNewVersionModal = false">Îã´Í∏∞
                <v-tooltip
                    activator="parent"
                    location="bottom">ALT + U
                </v-tooltip>
              </v-btn>
            </v-card-actions>
            <UpdateContent ref="updateContent" @submit="createNewVersion"
                           :dataToPass="documentList.getSelectedDocContent"></UpdateContent>
          </v-card>
        </v-dialog>

        <!--        Î≤ÑÏ†Ñ Î≥ÄÍ≤ΩÏùÑ ÏúÑÌïú Î™®Îã¨-->
        <v-dialog
            class="d-flex justify-start ml-12"
            width="60vw"
            opacity="10%"
            v-model="versionHistoryModal">
          <v-card
              rounded="xl"
              class="pa-4">
            <VersionHistory
                @version-changed="UpdateToastViewer"
                :selectDocumentId="documentList.getSelectedDocId"></VersionHistory>
          </v-card>
        </v-dialog>

      </v-col>
      <v-divider class="divider-container" vertical/>

      <!-- ‚òùÔ∏è‚òùÔ∏è‚òùÔ∏è‚òùÔ∏è‚òùÔ∏è‚òùÔ∏è‚òùÔ∏è Í∞ÄÏö¥Îç∞ Î¨∏ÏÑúÏ†úÎ™© Î∂ÄÎ∂Ñ -->
      <v-col cols="7" class="position-relative">
        <v-list class="pa-4">
          <v-card flat>
            <div class="d-flex justify-center">
              <v-card-title v-if="titleEditing" class="headline text-center">
                <v-text-field
                    class="title__update"
                    v-model="newTitle"
                    @blur="titleEditing = false"
                    @keyup.enter="updateDocumentTitle"
                    autofocus
                    persistent-placeholder
                    persistent-hint
                    append-inner-icon="mdi-keyboard-return"
                    hint="Î≥ÄÍ≤ΩÌï† Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏãúÍ≥† ÏóîÌÑ∞Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî."
                    placeholder="Î≥ÄÍ≤ΩÌï† Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî."
                    style="min-width: 40vw;"
                    variant="underlined"
                ></v-text-field>
              </v-card-title>

              <!-- Ï†úÎ™© ÌëúÏãú -->
              <v-card-title
                  @click="showTitleEditor"
                  v-else class="headline text-center mb-4 pa-2">
                {{ documentList.selectedDocumentDetails.title }}
              </v-card-title>
              <v-btn
                  class=" pt-0 pb-12 px-0"
                  variant="text"
                  rounded="xl"
                  @click="handleBookmarkClick">
                <v-icon
                    color="yellow-darken-2"
                    size="xxx-large"
                    :icon="isBookmarked ? 'mdi-star' : 'mdi-star-outline'"
                />
                <v-tooltip
                    activator="parent"
                    location="end"
                >ALT + M
                </v-tooltip>
              </v-btn>
            </div>
          </v-card>

          <!-- Í∞ÄÎ°ú ÏÑ† Ï∂îÍ∞Ä -->
          <v-divider></v-divider>
        </v-list>
        <v-card flat class="px-6 mt-4 mx-auto">
          <div ref="viewer">{{ documentList.getSelectedDocContent }}</div>
        </v-card>

        <!--        Ïä§ÌîºÎìú Î™®Îã¨ ÏïÑÏù¥ÏΩò-->
        <div class="fab_div">
          <v-container class="d-flex justify-end" style="margin: 30px;">
            <v-speed-dial v-model="KipButton" location="top center" transition="scale-transition">
              <template v-slot:activator="{ props: activatorProps }">
                <v-btn
                    rounded="circle"
                    elevation="4"
                    v-bind="activatorProps"
                    size="large"
                    stacked>
                  <v-tooltip
                      activator="parent"
                      location="start">ALT + Q
                  </v-tooltip>

                  <v-img
                      width="36px"
                      src="/images/logos/kiplogo.svg"/>
                </v-btn>
              </template>
              <v-btn
                  color="deep-orange-lighten-1"
                  class="mb-3"
                  key="4"
                  size="large"
                  rounded="xl"
                  prepend-icon="mdi-plus"
                  @click="openCreateNewDocument"> ÏÉàÍ∏ÄÏì∞Í∏∞
                <v-tooltip
                    activator="parent"
                    location="start">ALT + N
                </v-tooltip>
              </v-btn>
              <v-btn
                  color="light-green-darken-2"
                  style="width:200px !important;"
                  class="mb-3"
                  text="Ï†úÎ™©ÏàòÏ†ï"
                  key="1"
                  size="large"
                  rounded="xl"
                  prepend-icon="mdi-format-title"
                  @click="showTitleEditor">Ï†úÎ™©ÏàòÏ†ï
                <v-tooltip
                    activator="parent"
                    location="start">ALT + T
                </v-tooltip>
              </v-btn>
              <v-btn
                  :color="color.kipMainColor"
                  class="mb-3"
                  key="2"
                  size="large"
                  rounded="xl"
                  prepend-icon="mdi-pencil"
                  @click="createNewVersionModal=true"> ÎÇ¥Ïö©ÏàòÏ†ï
                <v-tooltip
                    activator="parent"
                    location="start">ALT + U
                </v-tooltip>

              </v-btn>
              <v-btn
                  :color="color.kipMainColor"
                  class="mb-3"
                  key="3"
                  size="large"
                  rounded="xl"
                  prepend-icon="mdi-history"
                  @click="versionHistoryModal=true">ÏàòÏ†ïÏù¥Î†•
                <v-tooltip
                    activator="parent"
                    location="start">ALT + Y
                </v-tooltip>
              </v-btn>
            </v-speed-dial>
          </v-container>
        </div>

      </v-col>
      <v-divider class="divider-container" vertical/>

      <!-- üëâüëâüëâüëâüëâüëâüëâüëâüëâ Ïò§Î•∏Ï™Ω ÏòÅÏó≠ -->
      <v-col cols="2">
        <!-- Ï≤®Î∂Ä ÌååÏùº ÏÑπÏÖò -->
        <div class="attached-files">
          <v-card flat>
            <v-card-title class="headline text-center">Ï≤®Î∂Ä ÌååÏùº
            </v-card-title>
            <!-- Ï≤®Î∂ÄÌååÏùº ÏóÖÎ°úÎìú Î°úÏßÅ Î∂ÄÎ∂Ñ -->
            <v-dialog
                class="d-flex justify-center"
                width="45vw"
                opacity="50%"
                v-model="fileDialog">

              <v-sheet
                  rounded="xl"
                  class="d-flex justify-center flex-wrap pa-10">

                <v-form ref="form" style="width: 50vw">
                  <v-file-input
                      v-model="files"
                      :color="color.kipMainColor"
                      label="ÏóÖÎ°úÎìúÌï† ÌååÏùºÏùÑ ÏÑ†ÌÉùÌï¥ Ï£ºÏÑ∏Ïöî"
                      placeholder="ÏóÖÎ°úÎìúÌï† ÌååÏùºÏùÑ ÏÑ†ÌÉùÌï¥ Ï£ºÏÑ∏Ïöî"
                      prepend-icon="mdi-paperclip"
                      counter
                      :show-size="1000"
                      multiple
                  >
                    <template v-slot:selection="{ fileNames }">
                      <template v-for="fileName in fileNames" :key="fileName">
                        <v-chip
                            class="ma-1 pa-5"
                            :color="color.kipMainColor"
                        >
                          {{ fileName }}
                        </v-chip>
                      </template>
                    </template>
                  </v-file-input>

                  <v-btn
                      class="mt-7"
                      :color="color.kipMainColor"
                      :loading="fileLoading"
                      text="ÏóÖÎ°úÎìú ÏôÑÎ£å"
                      @click="handleFileUpload"
                      block
                  />
                </v-form>
              </v-sheet>
            </v-dialog>


            <!-- Ï≤®Î∂ÄÌååÏùº Î™©Î°ù -->
            <v-card-text>
              <v-card
                  v-for="file in attachedFile.getAttachedFileList"
                  :key="file.fileName"
                  class="my-3"
                  color="blue-lighten-1"
                  variant="outlined"
                  rounded="xl">

                <v-row>
                  <v-col cols="3" class="d-flex justify-center align-center py-2">
                    <v-btn
                        class="ml-4"
                        @click="handleFileClick(file.fileUrl)"
                        :icon="file.fileType.includes('image') ? 'mdi-image-outline'
                          :`${file.fileType.includes('compressed') ? 'mdi-folder-zip'
                          :`${file.fileType.includes('application/pdf') ? 'mdi-file-pdf-box':'mdi-file-document-outline' }`}`"
                        variant="text"
                    />

                  </v-col>
                  <v-col cols="6" class="d-flex justify-start align-center py-2" style="width: 70%">
                    <div
                        @click="handleFileClick(file.fileUrl)"
                        class="cursor-pointer ellipsis" style="width:100%">
                      {{ file.fileName }}
                      <v-tooltip
                          activator="parent"
                          location="start"
                      >{{ file.fileName }}
                      </v-tooltip>
                    </div>
                  </v-col>

                  <v-col cols="3" class="d-flex justify-start align-center py-2">
                    <v-btn
                        class="mr-4"
                        @click="attachedFileModal=true"
                        icon="mdi-close"
                        variant="text"
                        rounded="xl"
                        size="sm"
                    />
                  </v-col>
                </v-row>
                <!--  Ï≤®Î∂ÄÌååÏùº ÏÇ≠Ï†úÎ•º ÏúÑÌïú Î™®Îã¨-->
                <v-dialog
                    v-model="attachedFileModal"
                    max-width="500">

                  <v-card title="Ï≤®Î∂ÄÌååÏùº ÏÇ≠Ï†ú">
                    <v-card-text>
                      Ï≤®Î∂ÄÌååÏùºÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?
                    </v-card-text>
                    <v-card-actions>
                      <v-spacer></v-spacer>

                      <v-snackbar
                          :timeout="2000"
                      >
                        <template v-slot:activator="{ props }">
                          <v-btn
                              v-bind="props"
                              @click="AttachedFileDelete(file.id)"
                          >Yes
                          </v-btn>
                        </template>
                        Ï≤®Î∂ÄÌååÏùºÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.
                      </v-snackbar>
                      <v-btn
                          text="No"
                          @click="attachedFileModal = false"
                      ></v-btn>
                    </v-card-actions>
                  </v-card>
                </v-dialog>
              </v-card>
              <v-btn
                  block
                  rounded="xl"
                  color="blue-lighten-1"
                  @click="fileDialogOpen"
                  variant="tonal">
                <v-icon
                    icon="mdi-plus"
                    size="x-large"
                ></v-icon>
                <v-tooltip
                    activator="parent"
                    location="start"
                >ALT + A
                </v-tooltip>
              </v-btn>
            </v-card-text>
          </v-card>
        </div>

        <!--    ‚è©‚è©‚è©‚è©‚è©  Ìï¥ÏãúÌÉúÍ∑∏ -->
        <v-chip prepend-icon="mdi-pencil"
                color="blue"
                class="mx-4 mb-0 mt-5"
                @click="hashTagUpdateModalOpen"> Ìï¥Ïãú ÌÉúÍ∑∏ ÏàòÏ†ï
          <v-tooltip
              activator="parent"
              location="start"
          > ALT + H
          </v-tooltip>
        </v-chip>
        <v-chip-group column class="px-4">
          <v-chip prepend-icon="mdi-refresh"
                  style="color: #4CAF50"
                  @click=documentList.setPublicDocumentList> Ï¥àÍ∏∞Ìôî
            <v-tooltip
                activator="parent"
                location="start"
            > ALT + R
            </v-tooltip>
          </v-chip>
          <v-chip
              v-for="(hashTag, index) in documentList.selectedDocumentDetails.hashTags"
              style="color: #546E7A"
              :key="index"
              @click="documentList.filterPublicDocByHashTag(hashTag['hashTagId'])">
            {{ hashTag.tagName }} ({{ hashTag['docsCounts'] }})
            <v-tooltip
                activator="parent"
                location="top"
            > ÌÉúÍ∑∏ÌïÑÌÑ∞ÎßÅ
            </v-tooltip>
          </v-chip>
        </v-chip-group>

        <!--           ‚ù§Ô∏è Ìï¥ÏãúÌÉúÍ∑∏ ÏàòÏ†ïÏùÑ ÏúÑÌïú Î™®Îã¨-->
        <v-dialog
            class="d-flex justify-center"
            width="60vw"
            opacity="10%"
            v-model="hashTagUpdateModal">
          <v-sheet
              rounded="xl"
              class="d-flex justify-center flex-wrap pa-10">
            <v-combobox
                variant="underlined"
                v-model="hashTagsUpdateReqDto.hashTags"
                multiple
                placeholder="ÌÉúÍ∑∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî."
                persistent-placeholder
                hint="Ïó¨Îü¨ ÌÉúÍ∑∏Î•º ÏóîÌÑ∞Î°ú Íµ¨Î∂ÑÌïòÏó¨ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.">
              <template v-slot:selection="data">
                <v-chip
                    class="pa-4 mr-1"
                    style="color: #FF5722"
                    :key="JSON.stringify(data.item)"
                    v-bind="data.attrs"
                    :disabled="data.disabled"
                    :model-value="data.selected"
                    size="large"
                    @click="documentList.filterTop100HashTagsByClick(data.item.title)">
                  {{ data.item.title }}
                  <v-tooltip
                      activator="parent"
                      location="top"
                  > ÌÉúÍ∑∏ Í≤ÄÏÉâ
                  </v-tooltip>
                </v-chip>
              </template>
            </v-combobox>
            <h2 class="mt-5 mb-3" style="width:100%; display: flex; justify-content: center"> üóº Top 100 Ìï¥ÏãúÌÉúÍ∑∏ üóº</h2>
            <v-chip-group column class="px-4 d-flex flex-wrap">
              <v-chip
                  prepend-icon="mdi-refresh"
                  style="color: #4CAF50"
                  @click="ResetHasTagAddAndFiltering"
              >
                Ï¥àÍ∏∞Ìôî
                <v-tooltip
                    activator="parent"
                    location="start"
                > ALT + R
                </v-tooltip>
              </v-chip>
              <v-chip
                  v-for="(hashTag, index) in documentList.fillteredTop100HaahTag"
                  style="color: #546E7A"
                  :key="index"
                  @click="Top100HashTagAddAndFiltering(hashTag['hashTagId'], hashTag.tagName)">
                {{ hashTag.tagName }}
                <v-tooltip
                    activator="parent"
                    location="top"
                > ÌÉúÍ∑∏ Ï∂îÍ∞Ä
                </v-tooltip>
              </v-chip>
            </v-chip-group>
            <v-btn
                class="mt-6"
                :color="color.kipMainColor"
                text="ÏàòÏ†ï ÌïòÍ∏∞"
                @click="hashTagUpdateReq"
                block
            />
          </v-sheet>
        </v-dialog>
      </v-col>
    </v-row>
  </v-container>
</template>
<style>
.font-weight-bold {
  font-weight: bold;
}

.headline {
  font-size: 1.5rem;
  font-weight: bold;
}

.divider-container {
  min-height: calc(97vh - 1.6vw - 90px);
}

.show-btns {
  color: var(--primary-color) !important;
}

.fab_div {
  justify-content: flex-end;
  display: flex;
  align-items: flex-end;
  bottom: 4vh;
  z-index: 1004;
  transform: translateY(0%);
  position: fixed;
  height: 80px;
  left: -4vw;
  width: calc(100% + 0px);
}

.title__update input:focus {
  font-size: 30px;
  font-weight: bold;
  text-align: center;
  padding: 20px 20px 20px 30px;
  margin-bottom: 2px;
  color: white;
  background-color: var(--primary-color);
  border-radius: 25px;
}
</style>